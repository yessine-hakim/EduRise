{% extends 'base.html' %}
{% load static %}

{% block title %}Cluster Maps - EduRise{% endblock %}
{% block meta_description %}Geographic clustering analysis and visualization of educational institutions{% endblock %}

{% block content %}
<section class="ml-page clusters-page">
    <div class="container">
        <div class="page-header">
            <h1>Institution Clustering Analysis</h1>
            <p class="page-subtitle">Geographic and typological clustering of educational institutions across France</p>
        </div>

        <div class="module-description">
            <h2>Module Purpose</h2>
            <p>The Clustering module identifies and visualizes patterns in educational institution distribution. 
               Using advanced machine learning algorithms, it groups institutions based on geographic location, 
               enrollment patterns, and institutional characteristics to reveal regional education landscapes and 
               inform strategic planning decisions.</p>
        </div>

        <!-- Section Exploration -->
        <div class="ml-section">
            <h2>Cluster Exploration</h2>
            <div class="exploration-card">
                <div class="cluster-stats-grid">
                    <div class="stat-card stat-cluster-0">
                        <div class="stat-icon">
                            <i class="fas fa-layer-group"></i>
                        </div>
                        <div class="stat-content">
                            <h3>Cluster 0</h3>
                            <p class="stat-label"> Small Rural Institutions</p>
                            <p class="stat-description"> Smaller institutions in rural areas with localized services</p>
                        </div>
                    </div>

                    <div class="stat-card stat-cluster-1">
                        <div class="stat-icon">
                            <i class="fas fa-layer-group"></i>
                        </div>
                        <div class="stat-content">
                            <h3>Cluster 1</h3>
                            <p class="stat-label">Medium-sized Institutions</p>
                            <p class="stat-description">Balanced institutions with moderate enrollment and resources</p>
                        </div>
                    </div>

                    <div class="stat-card stat-cluster-2">
                        <div class="stat-icon">
                            <i class="fas fa-layer-group"></i>
                        </div>
                        <div class="stat-content">
                            <h3>Cluster 2</h3>
                            <p class="stat-label">Urban Large Institutions</p>
                            <p class="stat-description">High-capacity institutions in urban areas with extensive resources</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Section Cartes Interactives -->
        <div class="ml-section">
            <h2>Interactive Cluster Maps</h2>
            
            <div class="maps-grid">
                {% for map in maps %}
                <div class="map-card">
                    <div class="map-card-header">
                        <h3>
                            <i class="fas fa-map-marked-alt"></i> 
                            {{ map.title }}
                        </h3>
                        <p class="map-description">{{ map.description }}</p>
                    </div>
                    
                    <div class="map-card-body">
                        <div class="map-preview">
                            <iframe 
                                src="{% static 'enrollment/maps_html/' %}{{ map.file }}" 
                                class="cluster-map-iframe"
                                title="{{ map.title }}"
                                loading="lazy">
                            </iframe>
                        </div>
                    </div>
                    
                    <div class="map-card-footer">
                        <button class="button button-secondary button-sm" onclick="expandMap('{{ map.file }}', '{{ map.title }}')">
                            <i class="fas fa-expand"></i> Full Screen
                        </button>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>

        <!-- Section Insights -->
        <div class="ml-section">
            <h2>Clustering Insights</h2>
            <div class="insights">
                <div class="insight-item">
                    <h4>Cluster Methodology</h4>
                    <p>The clustering analysis uses K-Means algorithm to identify natural groupings of institutions 
                       based on multiple dimensions including geographic location (latitude/longitude), enrollment capacity, 
                       institutional type, and service availability.</p>
                </div>
                <div class="insight-item">
                    <h4>Geographic Distribution</h4>
                    <p>The three identified clusters reveal distinct geographic patterns across France. Urban centers 
                       typically host Cluster 0 institutions with high capacity, while rural areas are characterized 
                       by Cluster 2 institutions with more localized services.</p>
                </div>
                <div class="insight-item">
                    <h4>Strategic Applications</h4>
                    <p>These clustering insights inform resource allocation, service planning, and policy decisions. 
                       Understanding cluster characteristics helps identify underserved areas, optimize service distribution, 
                       and plan for future institutional development.</p>
                </div>
            </div>
        </div>

        <!-- Section Statistiques -->
<div class="ml-section">
    <h2>Cluster Statistics</h2>
    <div class="output-container">

        <!-- Distribution Overview -->
        <div class="output-card">
            <h3>Distribution Overview</h3>
            <div class="stats-list">
                <div class="stats-row">
                    <span class="stats-label">Total Clusters:</span>
                    <span class="stats-value">3</span>
                </div>
                <div class="stats-row">
                    <span class="stats-label">Clustering Algorithm:</span>
                    <span class="stats-value">K-Means</span>
                </div>
                <div class="stats-row">
                    <span class="stats-label">Features Used:</span>
                    <span class="stats-value">10 dimensions</span>
                </div>
                <div class="stats-row">
                    <span class="stats-label">Geographic Coverage:</span>
                    <span class="stats-value">All French Departments</span>
                </div>
            </div>
        </div>

        <!-- Key Features -->
        <div class="output-card">
            <h3>Key Features</h3>
            <ul class="feature-list">
                <li><i class="fas fa-check"></i> Geographic coordinates (Latitude / Longitude)</li>
                <li><i class="fas fa-check"></i> Enrollment numbers</li>
                <li><i class="fas fa-check"></i> Number of classes</li>
                <li><i class="fas fa-check"></i> Institution type</li>
                <li><i class="fas fa-check"></i> Public / Private status</li>
                <li><i class="fas fa-check"></i> Service availability</li>
            </ul>
        </div>

        <!-- Applications -->
        <div class="output-card">
            <h3>Applications</h3>
            <ul class="feature-list">
                <li><i class="fas fa-bullseye"></i> Service planning and optimization</li>
                <li><i class="fas fa-bullseye"></i> Resource allocation strategies</li>
                <li><i class="fas fa-bullseye"></i> Policy development insights</li>
                <li><i class="fas fa-bullseye"></i> Regional education analysis</li>
            </ul>
        </div>

    </div>
</div>

</section>

<!-- Modal pour affichage plein écran -->
<div id="mapModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2 id="modalTitle"></h2>
            <button class="modal-close" onclick="closeModal()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="modal-body">
            <iframe id="modalIframe" src="" class="modal-iframe"></iframe>
        </div>
    </div>
</div>

<style>
    /* Cluster Stats Grid */
    .cluster-stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: var(--spacing-lg);
        margin-bottom: var(--spacing-xl);
    }

    .stat-card {
        background: var(--background);
        border: 1px solid var(--border-color);
        border-radius: var(--radius-lg);
        padding: var(--spacing-lg);
        display: flex;
        align-items: flex-start;
        gap: var(--spacing-md);
        transition: all 0.3s ease;
    }

    .stat-card:hover {
        transform: translateY(-4px);
        box-shadow: var(--shadow-lg);
    }

    .stat-cluster-0 {
        border-left: 4px solid #FFEDA0;
    }

    .stat-cluster-1 {
        border-left: 4px solid #FEB24C;
    }

    .stat-cluster-2 {
        border-left: 4px solid #F03B20;
    }

    .stat-icon {
        width: 50px;
        height: 50px;
        border-radius: var(--radius-md);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
        flex-shrink: 0;
    }

    .stat-cluster-0 .stat-icon {
        background: rgba(255, 237, 160, 0.2);
        color: #D4A000;
    }

    .stat-cluster-1 .stat-icon {
        background: rgba(254, 178, 76, 0.2);
        color: #E67E22;
    }

    .stat-cluster-2 .stat-icon {
        background: rgba(240, 59, 32, 0.2);
        color: #C0392B;
    }

    .stat-content h3 {
        font-size: 1.25rem;
        color: var(--primary);
        margin-bottom: 0.25rem;
    }

    .stat-label {
        font-weight: 600;
        color: var(--text-dark);
        margin-bottom: 0.5rem;
    }

    .stat-description {
        font-size: 0.9rem;
        color: var(--text-light);
    }

    /* Maps Grid */
    .maps-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(450px, 1fr));
        gap: var(--spacing-xl);
        margin-top: var(--spacing-lg);
    }

    .map-card {
        background: var(--background);
        border: 1px solid var(--border-color);
        border-radius: var(--radius-lg);
        overflow: hidden;
        box-shadow: var(--shadow-md);
        transition: all 0.3s ease;
    }

    .map-card:hover {
        box-shadow: var(--shadow-lg);
    }

    .map-card-header {
        background: var(--background-alt);
        padding: var(--spacing-md) var(--spacing-lg);
        border-bottom: 1px solid var(--border-color-light);
    }

    .map-card-header h3 {
        font-size: 1.1rem;
        color: var(--primary);
        margin-bottom: 0.5rem;
    }

    .map-description {
        font-size: 0.9rem;
        color: var(--text-light);
        margin: 0;
    }

    .map-card-body {
        padding: 0;
    }

    .map-preview {
        position: relative;
        height: 350px;
        width: 100%;
    }

    .cluster-map-iframe {
        width: 100%;
        height: 100%;
        border: none;
    }

    .map-card-footer {
        padding: var(--spacing-md) var(--spacing-lg);
        background: var(--background-alt);
        border-top: 1px solid var(--border-color-light);
        text-align: center;
    }

    /* Statistics */
    .stats-list {
        display: flex;
        flex-direction: column;
        gap: 1rem;
    }

    .stats-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0.75rem;
        background: var(--background-alt);
        border-radius: var(--radius-sm);
    }

    .stats-label {
        font-weight: 600;
        color: var(--text-dark);
    }

    .stats-value {
        font-weight: 700;
        color: var(--primary);
    }

    .feature-list {
        list-style: none;
        padding: 0;
        margin: 0;
    }

    .feature-list li {
        padding: 0.75rem;
        border-bottom: 1px solid var(--border-color-light);
        display: flex;
        align-items: center;
        gap: 0.75rem;
    }

    .feature-list li:last-child {
        border-bottom: none;
    }

    .feature-list i {
        color: var(--secondary);
    }

    /* Modal */
    .modal {
        display: none;
        position: fixed;
        z-index: 10000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.8);
        animation: fadeIn 0.3s;
    }

    .modal-content {
        background-color: var(--background);
        margin: 2% auto;
        width: 95%;
        height: 90%;
        border-radius: var(--radius-lg);
        display: flex;
        flex-direction: column;
        animation: slideIn 0.3s;
    }

    .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: var(--spacing-md) var(--spacing-lg);
        border-bottom: 1px solid var(--border-color);
    }

    .modal-header h2 {
        margin: 0;
        color: var(--primary);
    }

    .modal-close {
        background: none;
        border: none;
        font-size: 1.5rem;
        cursor: pointer;
        color: var(--text-light);
        transition: color 0.2s;
    }

    .modal-close:hover {
        color: var(--secondary);
    }

    .modal-body {
        flex: 1;
        padding: 0;
    }

    .modal-iframe {
        width: 100%;
        height: 100%;
        border: none;
    }

    @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
    }

    @keyframes slideIn {
        from {
            transform: translateY(-50px);
            opacity: 0;
        }
        to {
            transform: translateY(0);
            opacity: 1;
        }
    }

    /* Responsive */
    @media (max-width: 768px) {
        .maps-grid {
            grid-template-columns: 1fr;
        }

        .map-preview {
            height: 300px;
        }

        .modal-content {
            width: 100%;
            height: 100%;
            margin: 0;
            border-radius: 0;
        }
    }
</style>

<script>
    function expandMap(mapFile, mapTitle) {
        const modal = document.getElementById('mapModal');
        const modalIframe = document.getElementById('modalIframe');
        const modalTitle = document.getElementById('modalTitle');
        
        modalTitle.textContent = mapTitle;
        modalIframe.src = "{% static 'enrollment/maps_html/' %}" + mapFile;
        modal.style.display = 'block';
        
        document.body.style.overflow = 'hidden';
    }

    function closeModal() {
        const modal = document.getElementById('mapModal');
        const modalIframe = document.getElementById('modalIframe');
        
        modal.style.display = 'none';
        modalIframe.src = '';
        
        document.body.style.overflow = 'auto';
    }

    // Fermer avec Escape
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
            closeModal();
        }
    });

    // Fermer en cliquant à l'extérieur
    window.onclick = function(event) {
        const modal = document.getElementById('mapModal');
        if (event.target === modal) {
            closeModal();
        }
    }
</script>
{% endblock %} 
